name: Upload Trained Model to Release

on:
  workflow_dispatch:  # æ‰‹å‹•è§¸ç™¼
    inputs:
      release_name:
        description: 'Release åç¨±'
        required: true
        default: 'trained-model-v1.0'
      model_description:
        description: 'æ¨¡å‹æè¿°'
        required: false
        default: 'è²“ç‹—åˆ†é¡å™¨è¨“ç·´å®Œæˆçš„æ¨¡å‹'

jobs:
  upload-model:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    # å¾æœ€è¿‘çš„ Artifacts ä¸‹è¼‰æ¨¡å‹
    - name: Download latest trained model
      uses: actions/download-artifact@v4
      with:
        name: trained-cat-dog-model
        path: ./model-files/
        
    - name: Verify downloaded files
      run: |
        echo "ä¸‹è¼‰çš„æ–‡ä»¶ï¼š"
        ls -la ./model-files/
        
        if [ -f "./model-files/best_cat_dog_model.pth" ]; then
          echo "âœ… æ‰¾åˆ°æ¨¡å‹æ–‡ä»¶"
          file_size=$(stat -c%s "./model-files/best_cat_dog_model.pth")
          echo "æ¨¡å‹å¤§å°: $((file_size / 1024 / 1024)) MB"
        else
          echo "âŒ æœªæ‰¾åˆ°æ¨¡å‹æ–‡ä»¶"
          exit 1
        fi
        
    - name: Create Release with Model
      uses: softprops/action-gh-release@v2
      with:
        tag_name: ${{ github.event.inputs.release_name }}
        name: ${{ github.event.inputs.release_name }}
        body: |
          ğŸ±ğŸ¶ **è²“ç‹—åˆ†é¡å™¨è¨“ç·´å®Œæˆæ¨¡å‹**
          
          ${{ github.event.inputs.model_description }}
          
          **æ¨¡å‹è³‡è¨Šï¼š**
          - æ¶æ§‹: ResNet18
          - è¨“ç·´å®Œæˆæ™‚é–“: ${{ github.run_started_at }}
          - Commit: ${{ github.sha }}
          
          **ä½¿ç”¨æ–¹æ³•ï¼š**
          ```bash
          # ä¸‹è¼‰æ¨¡å‹æ–‡ä»¶
          wget https://github.com/${{ github.repository }}/releases/download/${{ github.event.inputs.release_name }}/best_cat_dog_model.pth
          
          # åŸ·è¡Œé æ¸¬
          python predict.py --model best_cat_dog_model.pth --image your_image.jpg
          ```
          
          **æˆ–ä½¿ç”¨å¿«é€Ÿé æ¸¬å·¥å…·ï¼š**
          ```bash
          python quick_predict.py --model-source github_release --create-test-images 10
          ```
        files: |
          ./model-files/best_cat_dog_model.pth
          ./model-files/training_curves.png
        draft: false
        prerelease: false
        generate_release_notes: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
